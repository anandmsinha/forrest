!function(e,t){"use strict";function n(e,n,r){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(i,a,o,c,l){function s(){f&&(r.cancel(f),f=null),d&&(d.$destroy(),d=null),g&&(f=r.leave(g),f.then(function(){f=null}),g=null)}function u(){var o=e.current&&e.current.locals;if(t.isDefined(o&&o.$template)){var o=i.$new(),c=e.current;g=l(o,function(e){r.enter(e,null,g||a).then(function(){!t.isDefined(h)||h&&!i.$eval(h)||n()}),s()}),d=c.scope=o,d.$emit("$viewContentLoaded"),d.$eval(m)}else s()}var d,g,f,h=o.autoscroll,m=o.onload||"";i.$on("$routeChangeSuccess",u),u()}}}function r(e,t,n){return{restrict:"ECA",priority:-400,link:function(r,i){var a=n.current,o=a.locals;i.html(o.$template);var c=e(i.contents());a.controller&&(o.$scope=r,o=t(a.controller,o),a.controllerAs&&(r[a.controllerAs]=o),i.data("$ngControllerController",o),i.children().data("$ngControllerController",o)),c(r)}}}e=t.module("ngRoute",["ng"]).provider("$route",function(){function e(e,n){return t.extend(Object.create(e),n)}function n(e,t){var n=t.caseInsensitiveMatch,r={originalPath:e,regexp:e},i=r.keys=[];return e=e.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?\*])?/g,function(e,t,n,r){return e="?"===r?r:null,r="*"===r?r:null,i.push({name:n,optional:!!e}),t=t||"",""+(e?"":t)+"(?:"+(e?t:"")+(r&&"(.+?)"||"([^/]+)")+(e||"")+")"+(e||"")}).replace(/([\/$\*])/g,"\\$1"),r.regexp=new RegExp("^"+e+"$",n?"i":""),r}var r={};this.when=function(e,i){var a=t.copy(i);if(t.isUndefined(a.reloadOnSearch)&&(a.reloadOnSearch=!0),t.isUndefined(a.caseInsensitiveMatch)&&(a.caseInsensitiveMatch=this.caseInsensitiveMatch),r[e]=t.extend(a,e&&n(e,a)),e){var o="/"==e[e.length-1]?e.substr(0,e.length-1):e+"/";r[o]=t.extend({redirectTo:e},n(o,a))}return this},this.caseInsensitiveMatch=!1,this.otherwise=function(e){return"string"==typeof e&&(e={redirectTo:e}),this.when(null,e),this},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$templateRequest","$sce",function(n,a,o,c,l,s,u){function d(e){var r=$.current;(p=(m=f())&&r&&m.$$route===r.$$route&&t.equals(m.pathParams,r.pathParams)&&!m.reloadOnSearch&&!v)||!r&&!m||n.$broadcast("$routeChangeStart",m,r).defaultPrevented&&e&&e.preventDefault()}function g(){var e=$.current,r=m;p?(e.params=r.params,t.copy(e.params,o),n.$broadcast("$routeUpdate",e)):(r||e)&&(v=!1,($.current=r)&&r.redirectTo&&(t.isString(r.redirectTo)?a.path(h(r.redirectTo,r.params)).search(r.params).replace():a.url(r.redirectTo(r.pathParams,a.path(),a.search())).replace()),c.when(r).then(function(){if(r){var e,n,i=t.extend({},r.resolve);return t.forEach(i,function(e,n){i[n]=t.isString(e)?l.get(e):l.invoke(e,null,null,n)}),t.isDefined(e=r.template)?t.isFunction(e)&&(e=e(r.params)):t.isDefined(n=r.templateUrl)&&(t.isFunction(n)&&(n=n(r.params)),n=u.getTrustedResourceUrl(n),t.isDefined(n)&&(r.loadedTemplateUrl=n,e=s(n))),t.isDefined(e)&&(i.$template=e),c.all(i)}}).then(function(i){r==$.current&&(r&&(r.locals=i,t.copy(r.params,o)),n.$broadcast("$routeChangeSuccess",r,e))},function(t){r==$.current&&n.$broadcast("$routeChangeError",r,e,t)}))}function f(){var n,i;return t.forEach(r,function(r){var o;if(o=!i){var c=a.path();o=r.keys;var l={};if(r.regexp)if(c=r.regexp.exec(c)){for(var s=1,u=c.length;u>s;++s){var d=o[s-1],g=c[s];d&&g&&(l[d.name]=g)}o=l}else o=null;else o=null;o=n=o}o&&(i=e(r,{params:t.extend({},a.search(),n),pathParams:n}),i.$$route=r)}),i||r[null]&&e(r[null],{params:{},pathParams:{}})}function h(e,n){var r=[];return t.forEach((e||"").split(":"),function(e,t){if(0===t)r.push(e);else{var i=e.match(/(\w+)(?:[?*])?(.*)/),a=i[1];r.push(n[a]),r.push(i[2]||""),delete n[a]}}),r.join("")}var m,p,v=!1,$={routes:r,reload:function(){v=!0,n.$evalAsync(function(){d(),g()})},updateParams:function(e){if(!this.current||!this.current.$$route)throw i("norout");var n={},r=this;t.forEach(Object.keys(e),function(t){r.current.pathParams[t]||(n[t]=e[t])}),e=t.extend({},this.current.params,e),a.path(h(this.current.$$route.originalPath,e)),a.search(t.extend({},a.search(),n))}};return n.$on("$locationChangeStart",d),n.$on("$locationChangeSuccess",g),$}]});var i=t.$$minErr("ngRoute");e.provider("$routeParams",function(){this.$get=function(){return{}}}),e.directive("ngView",n),e.directive("ngView",r),n.$inject=["$route","$anchorScroll","$animate"],r.$inject=["$compile","$controller","$route"]}(window,window.angular),!function(){"use strict";angular.module("angular-loading-bar",["cfp.loadingBarInterceptor"]),angular.module("chieffancypants.loadingBar",["cfp.loadingBarInterceptor"]),angular.module("cfp.loadingBarInterceptor",["cfp.loadingBar"]).config(["$httpProvider",function(e){var t=["$q","$cacheFactory","$timeout","$rootScope","cfpLoadingBar",function(t,n,r,i,a){function o(){r.cancel(l),a.complete(),u=0,s=0}function c(t){var r,i=n.get("$http"),a=e.defaults;!t.cache&&!a.cache||t.cache===!1||"GET"!==t.method&&"JSONP"!==t.method||(r=angular.isObject(t.cache)?t.cache:angular.isObject(a.cache)?a.cache:i);var o=void 0!==r?void 0!==r.get(t.url):!1;return void 0!==t.cached&&o!==t.cached?t.cached:(t.cached=o,o)}var l,s=0,u=0,d=a.latencyThreshold;return{request:function(e){return e.ignoreLoadingBar||c(e)||(i.$broadcast("cfpLoadingBar:loading",{url:e.url}),0===s&&(l=r(function(){a.start()},d)),s++,a.set(u/s)),e},response:function(e){return e.config.ignoreLoadingBar||c(e.config)||(u++,i.$broadcast("cfpLoadingBar:loaded",{url:e.config.url,result:e}),u>=s?o():a.set(u/s)),e},responseError:function(e){return e.config.ignoreLoadingBar||c(e.config)||(u++,i.$broadcast("cfpLoadingBar:loaded",{url:e.config.url,result:e}),u>=s?o():a.set(u/s)),t.reject(e)}}}];e.interceptors.push(t)}]),angular.module("cfp.loadingBar",[]).provider("cfpLoadingBar",function(){this.includeSpinner=!0,this.includeBar=!0,this.latencyThreshold=100,this.startSize=.02,this.parentSelector="body",this.spinnerTemplate='<div id="loading-bar-spinner"><div class="spinner-icon"></div></div>',this.loadingBarTemplate='<div id="loading-bar"><div class="bar"><div class="peg"></div></div></div>',this.$get=["$injector","$document","$timeout","$rootScope",function(e,t,n,r){function i(){u||(u=e.get("$animate"));var i=t.find(f).eq(0);n.cancel(g),v||(r.$broadcast("cfpLoadingBar:started"),v=!0,b&&u.enter(h,i),S&&u.enter(p,i),a(T))}function a(e){if(v){var t=100*e+"%";m.css("width",t),$=e,n.cancel(d),d=n(function(){o()},250)}}function o(){if(!(c()>=1)){var e=0,t=c();e=t>=0&&.25>t?(3*Math.random()+3)/100:t>=.25&&.65>t?3*Math.random()/100:t>=.65&&.9>t?2*Math.random()/100:t>=.9&&.99>t?.005:0;var n=c()+e;a(n)}}function c(){return $}function l(){$=0,v=!1}function s(){u||(u=e.get("$animate")),r.$broadcast("cfpLoadingBar:completed"),a(1),n.cancel(g),g=n(function(){var e=u.leave(h,l);e&&e.then&&e.then(l),u.leave(p)},500)}var u,d,g,f=this.parentSelector,h=angular.element(this.loadingBarTemplate),m=h.find("div").eq(0),p=angular.element(this.spinnerTemplate),v=!1,$=0,S=this.includeSpinner,b=this.includeBar,T=this.startSize;return{start:i,set:a,status:c,inc:o,complete:s,includeSpinner:this.includeSpinner,latencyThreshold:this.latencyThreshold,parentSelector:this.parentSelector,startSize:this.startSize}}]})}(),angular.module("mentio",[]).directive("mentio",["mentioUtil","$document","$compile","$log","$timeout",function(e,t,n,r,i){return{restrict:"A",scope:{macros:"=mentioMacros",search:"&mentioSearch",select:"&mentioSelect",items:"=mentioItems",typedTerm:"=mentioTypedTerm",altId:"=mentioId",iframeElement:"=mentioIframeElement",requireLeadingSpace:"=mentioRequireLeadingSpace",selectNotFound:"=mentioSelectNotFound",ngModel:"="},controller:["$scope","$timeout","$attrs",function(n,r,i){n.query=function(e,t){var r=n.triggerCharMap[e];r.showMenu(),r.search({term:t.trim()}),r.typedTerm=t.trim()},n.defaultSearch=function(e){var t=[];angular.forEach(n.items,function(n){n.label.toUpperCase().indexOf(e.term.toUpperCase())>=0&&t.push(n)}),n.localItems=t},n.bridgeSearch=function(e){var t=i.mentioSearch?n.search:n.defaultSearch;t({term:e})},n.defaultSelect=function(e){return n.defaultTriggerChar+e.item.label},n.bridgeSelect=function(e){var t=i.mentioSelect?n.select:n.defaultSelect;return t({item:e})},n.setTriggerText=function(e){n.syncTriggerText&&(n.typedTerm=e.trim())},n.context=function(){return n.iframeElement?{iframe:n.iframeElement}:void 0},n.replaceText=function(t,i){if(n.hideAll(),e.replaceTriggerText(n.context(),n.targetElement,n.targetElementPath,n.targetElementSelectedOffset,n.triggerCharSet,t,n.requireLeadingSpace,i),!i&&(n.setTriggerText(""),angular.element(n.targetElement).triggerHandler("change"),n.isContentEditable())){n.contentEditableMenuPasted=!0;var a=r(function(){n.contentEditableMenuPasted=!1},200);n.$on("$destroy",function(){r.cancel(a)})}},n.hideAll=function(){for(var e in n.triggerCharMap)n.triggerCharMap.hasOwnProperty(e)&&n.triggerCharMap[e].hideMenu()},n.getActiveMenuScope=function(){for(var e in n.triggerCharMap)if(n.triggerCharMap.hasOwnProperty(e)&&n.triggerCharMap[e].visible)return n.triggerCharMap[e];return null},n.selectActive=function(){for(var e in n.triggerCharMap)n.triggerCharMap.hasOwnProperty(e)&&n.triggerCharMap[e].visible&&n.triggerCharMap[e].selectActive()},n.isActive=function(){for(var e in n.triggerCharMap)if(n.triggerCharMap.hasOwnProperty(e)&&n.triggerCharMap[e].visible)return!0;return!1},n.isContentEditable=function(){return"INPUT"!==n.targetElement.nodeName&&"TEXTAREA"!==n.targetElement.nodeName},n.replaceMacro=function(t,i){i?e.replaceMacroText(n.context(),n.targetElement,n.targetElementPath,n.targetElementSelectedOffset,n.macros,n.macros[t]):(n.replacingMacro=!0,n.timer=r(function(){e.replaceMacroText(n.context(),n.targetElement,n.targetElementPath,n.targetElementSelectedOffset,n.macros,n.macros[t]),angular.element(n.targetElement).triggerHandler("change"),n.replacingMacro=!1},300),n.$on("$destroy",function(){r.cancel(n.timer)}))},n.addMenu=function(e){e.parentScope&&n.triggerCharMap.hasOwnProperty(e.triggerChar)||(n.triggerCharMap[e.triggerChar]=e,void 0===n.triggerCharSet&&(n.triggerCharSet=[]),n.triggerCharSet.push(e.triggerChar),e.setParent(n))},n.$on("menuCreated",function(e,t){(void 0!==i.id||void 0!==i.mentioId)&&(i.id===t.targetElement||void 0!==i.mentioId&&n.altId===t.targetElement)&&n.addMenu(t.scope)}),t.on("click",function(){n.isActive()&&n.$apply(function(){n.hideAll()})}),t.on("keydown keypress paste",function(e){var t=n.getActiveMenuScope();t&&((9===e.which||13===e.which)&&(e.preventDefault(),t.selectActive()),27===e.which&&(e.preventDefault(),t.$apply(function(){t.hideMenu()})),40===e.which&&(e.preventDefault(),t.$apply(function(){t.activateNextItem()})),38===e.which&&(e.preventDefault(),t.$apply(function(){t.activatePreviousItem()})),(37===e.which||39===e.which)&&e.preventDefault())})}],link:function(t,a,o){function c(e){function n(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}var r=t.getActiveMenuScope();if(r){if(9===e.which||13===e.which)return n(e),r.selectActive(),!1;if(27===e.which)return n(e),r.$apply(function(){r.hideMenu()}),!1;if(40===e.which)return n(e),r.$apply(function(){r.activateNextItem()}),!1;if(38===e.which)return n(e),r.$apply(function(){r.activatePreviousItem()}),!1;if(37===e.which||39===e.which)return n(e),!1}}if(t.triggerCharMap={},t.targetElement=a,o.$set("autocomplete","off"),o.mentioItems){t.localItems=[],t.parentScope=t;var l=o.mentioSearch?' mentio-items="items"':' mentio-items="localItems"';t.defaultTriggerChar=o.mentioTriggerChar?t.$eval(o.mentioTriggerChar):"@";var s='<mentio-menu mentio-search="bridgeSearch(term)" mentio-select="bridgeSelect(item)"'+l;o.mentioTemplateUrl&&(s=s+' mentio-template-url="'+o.mentioTemplateUrl+'"'),s=s+" mentio-trigger-char=\"'"+t.defaultTriggerChar+'\'" mentio-parent-scope="parentScope"/>';var u=n(s),d=u(t);a.parent().append(d),t.$on("$destroy",function(){d.remove()})}o.mentioTypedTerm&&(t.syncTriggerText=!0),t.$watch("iframeElement",function(e){if(e){var n=e.contentWindow.document;n.addEventListener("click",function(){t.isActive()&&t.$apply(function(){t.hideAll()})}),n.addEventListener("keydown",c,!0),t.$on("$destroy",function(){n.removeEventListener("keydown",c)})}}),t.$watch("ngModel",function(n){if(n&&""!==n){if(void 0===t.triggerCharSet)return void r.error("Error, no mentio-items attribute was provided, and no separate mentio-menus were specified.  Nothing to do.");if(t.contentEditableMenuPasted)return void(t.contentEditableMenuPasted=!1);t.replacingMacro&&(i.cancel(t.timer),t.replacingMacro=!1);var a=t.isActive(),o=t.isContentEditable(),c=e.getTriggerInfo(t.context(),t.triggerCharSet,t.requireLeadingSpace,a);if(void 0!==c&&(!a||a&&(o&&c.mentionTriggerChar===t.currentMentionTriggerChar||!o&&c.mentionPosition===t.currentMentionPosition)))c.mentionSelectedElement&&(t.targetElement=c.mentionSelectedElement,t.targetElementPath=c.mentionSelectedPath,t.targetElementSelectedOffset=c.mentionSelectedOffset),t.setTriggerText(c.mentionText),t.currentMentionPosition=c.mentionPosition,t.currentMentionTriggerChar=c.mentionTriggerChar,t.query(c.mentionTriggerChar,c.mentionText);else{var l=t.typedTerm;t.setTriggerText(""),t.hideAll();var s=e.getMacroMatch(t.context(),t.macros);if(void 0!==s)t.targetElement=s.macroSelectedElement,t.targetElementPath=s.macroSelectedPath,t.targetElementSelectedOffset=s.macroSelectedOffset,t.replaceMacro(s.macroText,s.macroHasTrailingSpace);else if(t.selectNotFound&&l&&""!==l){var u=t.triggerCharMap[t.currentMentionTriggerChar];if(u){var d=u.select({item:{label:l}});"function"==typeof d.then?d.then(t.replaceText):t.replaceText(d,!0)}}}}})}}}]).directive("mentioMenu",["mentioUtil","$rootScope","$log","$window","$document",function(e,t,n,r,i){return{restrict:"E",scope:{search:"&mentioSearch",select:"&mentioSelect",items:"=mentioItems",triggerChar:"=mentioTriggerChar",forElem:"=mentioFor",parentScope:"=mentioParentScope"},templateUrl:function(e,t){return void 0!==t.mentioTemplateUrl?t.mentioTemplateUrl:"mentio-menu.tpl.html"},controller:["$scope",function(e){e.visible=!1,this.activate=e.activate=function(t){e.activeItem=t},this.isActive=e.isActive=function(t){return e.activeItem===t},this.selectItem=e.selectItem=function(t){var n=e.select({item:t});"function"==typeof n.then?n.then(e.parentMentio.replaceText):e.parentMentio.replaceText(n)},e.activateNextItem=function(){var t=e.items.indexOf(e.activeItem);this.activate(e.items[(t+1)%e.items.length])},e.activatePreviousItem=function(){var t=e.items.indexOf(e.activeItem);this.activate(e.items[0===t?e.items.length-1:t-1])},e.selectActive=function(){e.selectItem(e.activeItem)},e.isVisible=function(){return e.visible},e.showMenu=function(){e.visible||(e.requestVisiblePendingSearch=!0)},e.setParent=function(t){e.parentMentio=t,e.targetElement=t.targetElement}}],link:function(a,o){if(o[0].parentNode.removeChild(o[0]),i[0].body.appendChild(o[0]),a.menuElement=o,a.parentScope)a.parentScope.addMenu(a);else{if(!a.forElem)return void n.error("mentio-menu requires a target element in tbe mentio-for attribute");if(!a.triggerChar)return void n.error("mentio-menu requires a trigger char");t.$broadcast("menuCreated",{targetElement:a.forElem,scope:a})}angular.element(r).bind("resize",function(){if(a.isVisible()){var t=[];t.push(a.triggerChar),e.popUnderMention(a.parentMentio.context(),t,o,a.requireLeadingSpace)}}),a.$watch("items",function(e){e&&e.length>0?(a.activate(e[0]),!a.visible&&a.requestVisiblePendingSearch&&(a.visible=!0,a.requestVisiblePendingSearch=!1)):a.hideMenu()}),a.$watch("isVisible()",function(t){if(t){var n=[];n.push(a.triggerChar),e.popUnderMention(a.parentMentio.context(),n,o,a.requireLeadingSpace)}}),a.hideMenu=function(){a.visible=!1,o.css("display","none")}}}}]).directive("mentioMenuItem",function(){return{restrict:"A",scope:{item:"=mentioMenuItem"},require:"^mentioMenu",link:function(e,t,n,r){e.$watch(function(){return r.isActive(e.item)},function(e){e?t.addClass("active"):t.removeClass("active")}),t.bind("mouseenter",function(){e.$apply(function(){r.activate(e.item)})}),t.bind("click",function(t){t.preventDefault(),r.selectItem(e.item)})}}}).filter("unsafe",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("mentioHighlight",function(){function e(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(t,n,r){if(n){var i=r?'<span class="'+r+'">$&</span>':"<strong>$&</strong>";return(""+t).replace(new RegExp(e(n),"gi"),i)}return t}}),angular.module("mentio").factory("mentioUtil",["$window","$location","$anchorScroll","$timeout",function(e,t,n,r){function i(e,t,n,i){var c,l=m(e,t,i,!1);void 0!==l?(c=o(e)?T(e,v(e).activeElement,l.mentionPosition):S(e,l.mentionPosition),n.css({top:c.top+"px",left:c.left+"px",position:"absolute",zIndex:100,display:"block"}),r(function(){a(e,n)},0)):n.css({display:"none"})}function a(t,n){for(var r,i=20,a=100,o=n[0];void 0===r||0===r.height;)if(r=o.getBoundingClientRect(),0===r.height&&(o=o.childNodes[0],void 0===o||!o.getBoundingClientRect))return;var c=r.top,l=c+r.height;if(0>c)e.scrollTo(0,e.pageYOffset+r.top-i);else if(l>e.innerHeight){var s=e.pageYOffset+r.top-i;s-e.pageYOffset>a&&(s=e.pageYOffset+a);var u=e.pageYOffset-(e.innerHeight-l);u>s&&(u=s),e.scrollTo(0,u)}}function o(e){var t=v(e).activeElement;if(null!==t){var n=t.nodeName,r=t.getAttribute("type");return"INPUT"===n&&"text"===r||"TEXTAREA"===n}return!1}function c(e,t,n,r){var i,a=t;if(n)for(var o=0;o<n.length;o++){if(a=a.childNodes[n[o]],void 0===a)return;for(;a.length<r;)r-=a.length,a=a.nextSibling;0!==a.childNodes.length||a.length||(a=a.previousSibling)}var c=p(e);i=v(e).createRange(),i.setStart(a,r),i.setEnd(a,r),i.collapse(!0);try{c.removeAllRanges()}catch(l){}c.addRange(i),t.focus()}function l(e,t,n,r){var i,a;a=p(e),i=v(e).createRange(),i.setStart(a.anchorNode,n),i.setEnd(a.anchorNode,r),i.deleteContents();var o=v(e).createElement("div");o.innerHTML=t;for(var c,l,s=v(e).createDocumentFragment();c=o.firstChild;)l=s.appendChild(c);i.insertNode(s),l&&(i=i.cloneRange(),i.setStartAfter(l),i.collapse(!0),a.removeAllRanges(),a.addRange(i))}function s(e,t,n,r){var i=t.nodeName;"INPUT"===i||"TEXTAREA"===i?t!==v(e).activeElement&&t.focus():c(e,t,n,r)}function u(e,t,n,r,i,a){s(e,t,n,r);var c=f(e,i);if(c.macroHasTrailingSpace&&(c.macroText=c.macroText+" ",a+=" "),void 0!==c){var u=v(e).activeElement;if(o(e)){var d=c.macroPosition,g=c.macroPosition+c.macroText.length;u.value=u.value.substring(0,d)+a+u.value.substring(g,u.value.length),u.selectionStart=d+a.length,u.selectionEnd=d+a.length}else l(e,a,c.macroPosition,c.macroPosition+c.macroText.length)}}function d(e,t,n,r,i,a,c,u){s(e,t,n,r);var d=m(e,i,c,!0,u);if(void 0!==d)if(o()){var g=v(e).activeElement;a+=" ";var f=d.mentionPosition,h=d.mentionPosition+d.mentionText.length+1;g.value=g.value.substring(0,f)+a+g.value.substring(h,g.value.length),g.selectionStart=f+a.length,g.selectionEnd=f+a.length}else a+=" ",l(e,a,d.mentionPosition,d.mentionPosition+d.mentionText.length+1)}function g(e,t){if(null===t.parentNode)return 0;for(var n=0;n<t.parentNode.childNodes.length;n++){var r=t.parentNode.childNodes[n];if(r===t)return n}}function f(e,t){var n,r,i=[];if(o(e))n=v(e).activeElement;else{var a=h(e);a&&(n=a.selected,i=a.path,r=a.offset)}var c=$(e);if(void 0!==c&&null!==c){var l,s=!1;if(c.length>0&&(" "===c.charAt(c.length-1)||" "===c.charAt(c.length-1))&&(s=!0,c=c.substring(0,c.length-1)),angular.forEach(t,function(e,t){var a=c.toUpperCase().lastIndexOf(t.toUpperCase());if(a>=0&&t.length+a===c.length){var o=a-1;(0===a||" "===c.charAt(o)||" "===c.charAt(o))&&(l={macroPosition:a,macroText:t,macroSelectedElement:n,macroSelectedPath:i,macroSelectedOffset:r,macroHasTrailingSpace:s})}}),l)return l}}function h(e){var t,n=p(e),r=n.anchorNode,i=[];if(null!=r){for(var a,o=r.contentEditable;null!==r&&"true"!==o;)a=g(e,r),i.push(a),r=r.parentNode,null!==r&&(o=r.contentEditable);return i.reverse(),t=n.getRangeAt(0).startOffset,{selected:r,path:i,offset:t}}}function m(e,t,n,r,i){var a,c,l;if(o(e))a=v(e).activeElement;else{var s=h(e);s&&(a=s.selected,c=s.path,l=s.offset)}var u=$(e);if(void 0!==u&&null!==u){var d,g=-1;if(t.forEach(function(e){var t=u.lastIndexOf(e);t>g&&(g=t,d=e)}),g>=0&&(0===g||!n||/[\xA0\s]/g.test(u.substring(g-1,g)))){var f=u.substring(g+1,u.length);d=u.substring(g,g+1);var m=f.substring(0,1),p=f.length>0&&(" "===m||" "===m);if(i&&(f=f.trim()),!p&&(r||!/[\xA0\s]/g.test(f)))return{mentionPosition:g,mentionText:f,mentionSelectedElement:a,mentionSelectedPath:c,mentionSelectedOffset:l,mentionTriggerChar:d}}}}function p(e){return e?e.iframe.contentWindow.getSelection():window.getSelection()}function v(e){return e?e.iframe.contentWindow.document:document}function $(e){var t;if(o(e)){var n=v(e).activeElement,r=n.selectionStart;t=n.value.substring(0,r)}else{var i=p(e).anchorNode;if(null!=i){var a=i.textContent,c=p(e).getRangeAt(0).startOffset;c>=0&&(t=a.substring(0,c))}}return t}function S(e,t){var n,r,i="",a="sel_"+(new Date).getTime()+"_"+Math.random().toString().substr(2),o=p(e),c=o.getRangeAt(0);r=v(e).createRange(),r.setStart(o.anchorNode,t),r.setEnd(o.anchorNode,t),r.collapse(!1),n=v(e).createElement("span"),n.id=a,n.appendChild(v(e).createTextNode(i)),r.insertNode(n),o.removeAllRanges(),o.addRange(c);var l={left:0,top:n.offsetHeight};return b(e,n,l),n.parentNode.removeChild(n),l}function b(e,t,n){for(var r=t,i=e?e.iframe:null;r;)n.left+=r.offsetLeft,n.top+=r.offsetTop,r!==v().body&&(n.top-=r.scrollTop,n.left-=r.scrollLeft),r=r.offsetParent,!r&&i&&(r=i,i=null)}function T(e,t,n){var r=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"],i=null!==window.mozInnerScreenX,a=v(e).createElement("div");a.id="input-textarea-caret-position-mirror-div",v(e).body.appendChild(a);var o=a.style,c=window.getComputedStyle?getComputedStyle(t):t.currentStyle;o.whiteSpace="pre-wrap","INPUT"!==t.nodeName&&(o.wordWrap="break-word"),o.position="absolute",o.visibility="hidden",r.forEach(function(e){o[e]=c[e]}),i?(o.width=parseInt(c.width)-2+"px",t.scrollHeight>parseInt(c.height)&&(o.overflowY="scroll")):o.overflow="hidden",a.textContent=t.value.substring(0,n),"INPUT"===t.nodeName&&(a.textContent=a.textContent.replace(/\s/g," "));var l=v(e).createElement("span");l.textContent=t.value.substring(n)||".",a.appendChild(l);var s={top:l.offsetTop+parseInt(c.borderTopWidth)+parseInt(c.fontSize),left:l.offsetLeft+parseInt(c.borderLeftWidth)};return b(e,t,s),v(e).body.removeChild(a),s}return{popUnderMention:i,replaceMacroText:u,replaceTriggerText:d,getMacroMatch:f,getTriggerInfo:m,selectElement:c,getTextAreaOrInputUnderlinePosition:T,getTextPrecedingCurrentSelection:$,getContentEditableSelectedPath:h,getNodePositionInParent:g,getContentEditableCaretPosition:S,pasteHtml:l,resetSelection:s,scrollIntoView:a}}]),angular.module("mentio").run(["$templateCache",function(e){e.put("mentio-menu.tpl.html",'<style>\n.scrollable-menu {\n    height: auto;\n    max-height: 300px;\n    overflow: auto;\n}\n\n.menu-highlighted {\n    font-weight: bold;\n}\n</style>\n<ul class="dropdown-menu scrollable-menu" style="display:block">\n    <li mentio-menu-item="item" ng-repeat="item in items track by $index">\n        <a class="text-primary" ng-bind-html="item.label | mentioHighlight:typedTerm:\'menu-highlighted\' | unsafe"></a>\n    </li>\n</ul>')}]),function(){var e;e=angular.module("mainForrestApp",["ngRoute","angular-loading-bar","mentio"]),e.directive("urlText",function(){var e;return e={restrict:"A",require:"ngModel",link:function(e,t,n,r){return r.$parsers.unshift(function(e){var t;return t=new RegExp("([a-zA-Z0-9]+://)?([a-zA-Z0-9_]+:[a-zA-Z0-9_]+@)?([a-zA-Z0-9.-]+\\.[A-Za-z]{2,4})(:[0-9]+)?(/.*)?"),r.$setValidity("urlAndText",t.test(e)),e})}}}),e.filter("dateandtime",function(){return function(e){return new Date(e).toLocaleString()}}),e.filter("reverse",function(){return function(e){return angular.isArray(e)?e.slice().reverse():!1}}),e.filter("removehash",function(){return function(e){var t;return e&&e.length>0?(t=new RegExp("#([^\\s]*)","g"),e.replace(t,"")):""}}),e.factory("$appModes",function(){var e;return e={createQuest:!1},this.setCreateMode=function(t){return e.createQuest=t},this.getModes=function(){return e},this}),e.factory("$authService",function(){var e;return e={is_login:!1,id:"",name:""},this.changeUser=function(t){return e.is_login=t.is_login,e.id=t.id||t._id,e.name=t.name},this.resetUser=function(){return e.is_login=!1,e.id="",e.name=""},this.getUser=function(){return e},this}),e.factory("$questService",["$http","$window",function(e,t){var n,r,i;return i=[],r={},n=!1,this.fetchQuests=function(){var r;return r="Failed to fetch quests",e.get("/backend/quests").success(function(e){var a,o,c,l,s;if(!e.status)return a=e.message||r,t.alert(a);for(n=!0;i.length>0;)i.pop();for(s=e.quests,c=0,l=s.length;l>c;c++)o=s[c],i.push(o)}).error(function(e){var n;return n=e.message||r,t.alert(n)})},this.addQuest=function(n){var r;return r="Failed to add request",e.post("/backend/quests",{name:n}).success(function(e){var n,a;return e.status?(a=e.quest,Array.isArray(e.quest)&&(a=e.quest[0]),i.push(a),void 0):(n=e.message||r,t.alert(n))}).error(function(e){var n;return n=e.message||r,t.alert(n)})},this.clearQuests=function(){for(var e;i.length>0;)i.pop();for(e in r)delete r[e];return n=!1},this.getLinks=function(n){var i;return i="Failed to fetch links for quest",r[n]?r[n]:(e.post("/backend/quests/fetch",{quest_id:n}).success(function(e){var a;return e.status?r[n]=e.quest:(a=e.message||i,t.alert(a))}).error(function(){return t.alert(i)}),r[n])},this.addLink=function(n,i){var a;return a="Failed to add link",i.quest_id=n,e.post("/backend/quest/add",i).success(function(e){var i;return e.status?r[n]=e.quest:(i=e.message||a,t.alert(i))}).error(function(){return t.alert(a)})},this.getQuests=function(){return n||this.fetchQuests(),i},this}]),e.controller("NavBarController",["$scope","$authService","$appModes","$location",function(e,t,n,r){return e.user=t.getUser(),e.initUser=function(e){return t.changeUser(JSON.parse(e))},e.changeToQuestMode=function(){return n.setCreateMode(!0),"/board"!==r.path()?r.path("/board"):void 0}}]),e.controller("HomePageController",["$scope","$authService",function(e,t){var n;return n=t.getUser()}]),e.controller("LoginController",["$scope","$authService","$http","$location",function(e,t,n,r){return e.user=t.getUser(),e.loginForm={},e.formSubmitted=!1,e.submitForm=function(){var i;return e.formSubmitted=!0,i={username:e.loginForm.username,password:e.loginForm.password},n.post("/login",i).success(function(e){return e.status&&e.user?(t.changeUser(e.user),r.path("/board")):alert("Auth failed")}).error(function(){return alert("Auth failed")})}}]),e.controller("BoardController",["$scope","$authService","$questService","$appModes","$http","$window",function(e,t,n,r,i,a){var o,c;return e.quests=n.getQuests(),e.defaultQuest=0,e.questObject={},e.linksDataStructure={},e.allTags=[],o=!1,e.$watchCollection("quests",function(t){return t.length>0&&!o?e.changeQuest(0):void 0}),e.$watch("questObject",function(t){for(var n,r,i,a,o;e.allTags.length>0;)e.allTags.pop();if(t&&t.links){for(r={untagged:[]},o=t.links,i=0,a=o.length;a>i;i++)n=o[i],n.tags&&0!==n.tags.length?(e.allTags.push({label:n.tags[0]}),r[n.tags[0]]||(r[n.tags[0]]=[]),r[n.tags[0]].push(n)):r.untagged.push(n);return e.linksDataStructure=r}return e.linksDataStructure={}}),e.appModes=r.getModes(),e.createQuestForm={},e.addLinkForm={},c=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,e.createQuest=function(){return n.addQuest(e.createQuestForm.quest),e.createQuestForm.quest=""},e.createLink=function(t){var n,r,o;return o=e.addLinkForm.link.match(c),0===o.length?void alert("No link in text"):(r={quest_id:e.quests[e.defaultQuest]._id,link:o[0],desc:e.addLinkForm.link.replace(o[0],"")},n="Failed to add link",i.post("/backend/quests/add",r).success(function(t){var r;return t.status?e.questObject=t.quest:(r=t.message||n,a.alert(r))}).error(function(){return a.alert(n)}),e.addLinkForm.link="",t.$setPristine(),t.$setUntouched())},e.changeQuest=function(t){var n;return o=!0,0!==e.quests.length?(n="Failed to fetch links",e.defaultQuest=t,i.post("/backend/quests/fetch",{quest_id:e.quests[e.defaultQuest]._id}).success(function(t){var r;return t.status?e.questObject=t.quest:(r=t.message||n,a.alert(r))}).error(function(){return a.alert(n)})):void 0}}]),e.controller("LogoutController",["$scope","$authService","$http","$location","$questService",function(e,t,n,r,i){return n.post("/logout").success(function(e){return e.status?(t.resetUser(),i.clearQuests(),r.path("/")):alert("Auth failed")}).error(function(){return alert("Some error occured"),r.path("/board")})}]),e.controller("RegisterController",["$scope","$authService","$http","$location",function(e,t,n,r){return t.getUser().is_login&&r.path("/board"),e.registerForm={},e.formSubmitted=!1,e.submitForm=function(){var i;return i={username:e.registerForm.username,password:e.registerForm.password},n.post("/register",i).success(function(e){var n;return e.status&&e.user?(e.user.is_login=!0,t.changeUser(e.user),r.path("/board")):(n=e.message||"Registration failed",alert(n))}).error(function(e){var t;return t=e.message||"Registration failed",alert(t)})}}]),e.config(["$routeProvider","$locationProvider",function(e,t){return e.when("/",{templateUrl:"/root.html",controller:"HomePageController",config:{authRequired:!1}}).when("/login",{templateUrl:"/login.html",controller:"LoginController",config:{authRequired:!1}}).when("/register",{templateUrl:"/register.html",controller:"RegisterController",config:{authRequired:!1}}).when("/board",{templateUrl:"/board.html",controller:"BoardController",config:{authRequired:!0}}).when("/logout",{template:"",controller:"LogoutController",config:{authRequired:!0}}).otherwise({redirectTo:"/"}),t.html5Mode(!1)}]),e.run(["$rootScope","$location","$authService",function(e,t,n){e.$on("$routeChangeStart",function(e,r){return r.$$route.config&&r.$$route.config.authRequired&&!n.getUser().is_login?t.path("/login"):void 0})}])}.call(this);